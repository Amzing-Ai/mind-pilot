# 任务分析页面功能文档

## 概述

任务分析页面 (`/analysis`) 提供了全面的任务完成情况分析和用户行为洞察，帮助用户了解自己的工作效率和习惯。

## 主要功能

### 1. 数据统计概览

- **累计创建任务**: 显示用户创建的总任务数
- **当前连续天数**: 基于最近7天的任务完成情况计算
- **最佳完成时段**: 分析24小时内任务完成最多的时段
- **全球排名**: 基于完成任务数计算用户在全球用户中的排名

### 2. 全年活动热力图

- GitHub风格的活动热力图
- 显示过去52周的任务完成情况
- 每个方块代表一天，颜色深浅表示任务完成数量
- 支持鼠标悬停查看具体日期和任务数

### 3. 24小时活动分布

- 柱状图显示一天中每个小时的任务完成情况
- 渐变色彩表示活动强度
- 自动识别最高效的工作时段
- 提供个性化的工作时间建议

### 4. 全球排行榜

- 显示前10名用户的任务完成情况
- 包含完成任务数和连续天数统计
- 当前用户会高亮显示
- 前三名显示特殊奖杯图标

### 5. 智能洞察

- **持续进步**: 本周与上周的任务完成对比
- **目标达成**: 本月目标完成进度
- **超越自我**: 用户超越其他用户的百分比

## 技术实现

### 数据查询

- 使用Prisma ORM进行数据库查询
- 实现复杂的数据聚合和统计计算
- 支持实时数据更新

### 响应式设计

- 移动端友好的布局设计
- 自适应网格系统
- 触摸友好的交互元素

### 动画效果

- 使用Framer Motion实现流畅的进入动画
- 悬停和点击交互效果
- 渐进式加载动画

### 性能优化

- 服务端数据预加载
- 客户端状态管理
- 骨架屏加载状态

## 文件结构

```
src/
├── app/analysis/
│   └── page.tsx                 # 分析页面路由
├── actions/
│   └── analysis.ts              # 数据查询逻辑
└── components/
    └── TaskAnalysisPage.tsx     # 主分析组件
```

## 数据模型

### 统计数据结构

```typescript
interface TaskStats {
  totalTasks: number; // 总任务数
  completedTasks: number; // 已完成任务数
  currentStreak: number; // 当前连续天数
  longestStreak: number; // 最长连续天数
  bestHour: number; // 最佳完成时段
  bestHourCount: number; // 最佳时段任务数
  globalRank: number; // 全球排名
  rankPercentile: number; // 排名百分位
  hourlyDistribution: Array<{
    // 24小时分布
    hour: number;
    count: number;
  }>;
}
```

### 活动数据结构

```typescript
interface ActivityData {
  date: string; // 日期
  count: number; // 任务完成数
  week: number; // 周数
  day: number; // 星期几
}
```

## 使用说明

1. 用户登录后访问 `/analysis` 页面
2. 页面自动加载用户的任务数据
3. 支持实时查看各项统计指标
4. 可以通过热力图和图表了解工作习惯
5. 排行榜功能提供竞争激励

## 未来扩展

- 添加更多时间维度的分析（月度、季度、年度）
- 实现任务分类统计
- 添加效率趋势分析
- 支持数据导出功能
- 增加个性化建议系统
